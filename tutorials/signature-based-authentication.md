# Signature-based Authentication #

When interacting with the Creative Channel Services REST API, some requests
must be authenticated. These requests are authenticated by computing a digital
signature against a unique, private API key that only the  requesting agent and
the CCS server know. The CCS REST API also uses a timestamp and a unique,
agent-generated identity to ensure that no one else may use or intercept
the request.

### API Key ###

When approved for access to the CCS REST API, each customer/partner is provided
with an API key, which consists of two text strings: a public key string and a
private key string. The private key string is secret and should never be
included in an API request or exchanged with any other party.

#### Example API key ####

```
public_key: rE2aWawru3aveSp
private_key: TAc3wRus9ESteVu5W4744UvudrUPhe
```

### Authenticating API Requests ###

There are three levels of security for requests, each having its own
authentication requirements:

1.  ***Public requests***
    anonymous requests which do not require any authorization

2.  ***Signed requests***
    standalone interactions which require the agent to have
    permission to access the API

3.  ***In-session requests***
    the agent maintains an ongoing, interactive session with the CCS server on
    behalf of an end-user

All non-public requests must contain authentication information to establish the
identity of the agent making the request. The information is submitted using
[query string][] parameters.

#### Required Parameters ####

-   signature
    the HMAC-SHA1 signature for the request
-   nonce
    a unique, random string generated by the agent to identify the request
-   stamp
    the date and time when the request was generated

#### Signed Request Parameters ####

-   api_key
    when making single, stateless requests, the public API key code
    identifies the subscription account of the customer or partner

#### In-session Parameters ####

-   session
    the unique identity for the session provided by CCS REST server

### Authorization Parameters ###

#### signature ####

The signature is an encrypted token that assists in verifying the identity of
the customer or partner submitting the request. Signing a request is described
in detail in the [generate signature section][].

#### nonce ####

The [nonce][] is a unique, random string used to identify a request. The nonce
must a unique random string 8-36 characters long. The nonce assists in
preventing "man-in-the-middle" attacks, in which a 3rd party tries to repeat a
request that an agent has already submitted.

***Using a random string and timestamp as a nonce:***

```
nonce=te7Et4dr1356621750
```

***Using [uuid][] as a nonce:***

```
nonce=4FAC90E7-8CF1-4180-B47B-09C3A246CB67
```

#### stamp ####

The stamp is the [POSIX timestamp][]
the number of seconds that have occurred since midnight on January 1, 1970 UTC.
Requests must be stamped within 15 minutes of the current server time.

The current server time can be obtained from the API service using the
CCS REST API function authapi->currenttimestamp. This request does not require
any authorization. To try this function,
visit https://api.creativechannel.com/api/rest/v2/authapi/currenttimestamp

*Example:
setting the timestamp for Thursday, December 27th, 2012 at 15:22:30 UTC*

```
stamp=1356621750
```

#### api_key ####

The public key string from the API key provided by Creative Channel Services
must be included in all non-session-based requests.

*For the fictional corporation MyCompany, the public API key is
'rE2aWawru3aveSp':*

```
api_key=rE2aWawru3aveSp
```

### Generating a Signature ###

When making a request to the CCS REST API, an agent must generate a digital
signature for the request using the assigned private key string.
The signature must be submitted in the request. When the CCS REST API receives
the request, the server retrieves the agent's private key and generates a new
iteration of the signature. If the agent and server signatures match, the
request is accepted and the action is performed. If the signatures do not match,
the server rejects the request and returns an error message.

Since only the agent and the server have knowledge of the private key, no other
party can submit a valid request on the agent's behalf.

#### Signing Process ####

1.  Create a string by concatenating specific values for the request
    (in order):
    **private key + HTTP METHOD + stamp + nonce + requested action**

2.  Generate a [HMAC sha1 hash][] for the string using the private key as the
    HMAC shared secret

3.  Submit the signature in the query string for the request

#### Required Values for a Signature Hash ####

-   ***[private key][]***
    the secret key string assigned to the agent

-   ***METHOD***
    the [HTTP method][] used for the request (GET, POST, PUT, or DELETE). The
    value must be in upper-case

-   ***[stamp][]***
    the current POSIX timestamp

-   ***[nonce][]***
    the agent-generated unique identity for the request

-   ***requested action***
    the '''route''' portion of the URL-encoded request URI, up to but not
    including the question mark (?) separator. The value must be in lower-case

*Examples...*

-   *https://api.creativechannel.com/profile/username/thisTEST.guy?optionalthing=1*
    requested action = **`profile/username/thistest.guy`**
-   *https://api.creativechannel.com/profile/uuid?username=thistest.guy*
    requested action = **`profile/uuid`**

#### Sample Request ####

*The following is a fictional request to retrieve current information about a
member's profile*
    Member's username: `test.guy`
    API public key: `1CMUPjlfBmvL9ZvSqJO`
    API private key: `TAc3wRus9ESteVu5W4744UvudrUPhe`
    current POSIX timestamp: `1356621750`
    nonce: `te7Et4dr1356621750`
    requested action: `profile/username/test.guy`

##### Request before generating signature #####

```
https://api.creativechannel.com/profile/username/test.guy?api_key=rE2aWawru3aveSp&stamp=1356621750&nonce=te7Et4dr1356621750
```

**String segments for signature hash**

<table>
    <tr>
        <th>Private Key</th>
        <th>HTTP Method</th>
        <th>Stamp</th>
        <th>Nonce</th>
        <th>Requested Action</th>
    </tr>
    <tr>
        <td>TAc3wRus9ESteVu5W4744UvudrUPhe</td>
        <td>GET</td>
        <td>1356621750</td>
        <td>te7Et4dr1356621750</td>
        <td>profile/username/test.guy</td>
    </tr>
</table>

**Concatenated string for signature hash**

```
TAc3wRus9ESteVu5W4744UvudrUPheGET1356621750te7Et4dr1356621750profile/username/test.guy
```

**HMAC-SHA1 Signature**

```
598ff1072b8321b235ed7969c5dfd577c0b4bae8
```

##### Full request URI with signature #####

```
https://api.creativechannel.com/profile/username/test.guy?api_key=rE2aWawru3aveSp&stamp=1356621750&nonce=te7Et4dr1356621750&signature=598ff1072b8321b235ed7969c5dfd577c0b4bae8
```

#### Programming References for HMAC SHA1  ####

Explanations for generating HMAC SHA1 signatures in various
programming/scripting languages are listed below. Please contact the authors
directly for documentation and support.

-   PHP: http://php.net/manual/en/function.hash-hmac.php
-   Ruby: http://ruby-hmac.rubyforge.org/
-   JavaScript: http://jssha.sourceforge.net/
-   Perl: http://cpan.uwinnipeg.ca/htdocs/Digest-HMAC/Digest/HMAC.pm.html
-   .NET: http://msdn.microsoft.com/en-us/library/system.security.cryptography.hmac.aspx
-   Python: http://docs.python.org/lib/module-hmac.html

<!-- Link definitions -->
[Restler]: http://luracast.com/products/restler/ "Luracast Restler"
[API authentication]: https://github.com/creativechannel/api/wiki/Signature-based-Authentication "Signature-based Authentication"
[W3C headers]: [http://www.w3.org/Protocols/HTTP/HTRQ_Headers.html#z3 "W3C documentation"
[query string]: http://en.wikipedia.org/wiki/Query_string "query string"
[uuid]: http://www.ietf.org/rfc/rfc4122.txt "RFC 1422 v4 UUID"
[nonce]: http:en.wikipedia.org/wiki/Cryptographic_nonce "nonce"
[generate signature section]: #generating-a-signature "generating a signature"
[POSIX timestamp]: http://en.wikipedia.org/wiki/Unix_time "POSIX epoch timestamp"
[HMAC sha1 hash]: http://tools.ietf.org/html/rfc2104 "HMAC SHA1 signature hash"
[private key]: #api-key "API private key"
[HTTP method]: http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods "HTTP method"
[IETF BCP47 spec]: http://tools.ietf.org/html/bcp47 "IETF BCP 47 specification"
[language tag lookup]: http://rishida.net/utils/subtags/ "Language tag look-up"
[stamp]: #stamp "stamp"
[nonce]: #nonce "nonce"
[POST profile]: #post_profile "POST profile/"